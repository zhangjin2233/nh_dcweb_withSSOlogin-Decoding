webpackJsonp([12],{TM1l:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("mvHQ"),o=s.n(i),n=s("woOf"),l=s.n(n),a={mixins:[{name:"webUploader",data:function(){return{fileList:[],body:{},uploadCount:0,fileCount:0,uploadMessage:"",successInfo:[],errorInfo:[],object:{}}},props:[],created:function(){var t=this;this.object=this.$importFile,this.$nextTick(function(){t.fileList=t.$refs.upload.uploadFiles})},methods:{submitUpload:function(){this.object.form&&(this.object.submitForm=l()(this.object.form.data,this.object.submitForm),this.object.body.FILTER=o()(this.object.submitForm)),this.$refs.upload.submit()},handleExceed:function(){this.$message({type:"warning",message:"文件超出限制数量"})},handleError:function(){this.$message({type:"error",message:"上传失败"})},handleSuccess:function(t,e,s){this.fileCount||(this.fileCount=s.length),e.status="uploading",1==t.STATE?(this.uploadCount++,e.status="success",this.uploadMessage+='<p style="color: green">'+e.name+": 上传成功</p>",this.successInfo.push({fileName:e.name,res:t})):(this.uploadCount++,e.status="error",this.uploadMessage+='<p style="color: red">'+e.name+": 上传失败</p>",this.errorInfo.push({fileName:e.name,res:t})),this.uploadCount===this.fileCount&&(this.$notify({title:"上传文件信息",dangerouslyUseHTMLString:!0,message:this.uploadMessage,offset:100}),this.uploadCount=0,this.fileCount=0,this.uploadMessage=[],this.uploadMessage="",this.successInfo.length>0&&(this.object.handleSuccess(this.successInfo),this.object.close()),this.errorInfo.length>0&&this.object.handleError(this.errorInfo),this.successInfo=[],this.errorInfo=[])},fileChange:function(t,e){var s=this;if("image"===this.object.type){var i=new FileReader;i.readAsDataURL(t.raw),i.onload=function(e){s.$set(t,"src",i.result)}}if(this.object.accept.length>0){var o=t.name.lastIndexOf("."),n=t.name.slice(o+1);if(-1!==this.object.accept.indexOf(n)&&-1===this.fileList.indexOf(t))this.object.multiple||this.fileList.splice(0,2),this.fileList.push(t);else{var l=e.indexOf(t);e.splice(l,1)}}else this.object.multiple||(this.fileList.splice(0,2),this.fileList.push(t))},removeFile:function(t){var e=this.fileList.findIndex(function(e){return e===t});this.fileList.splice(e,1)},clear:function(){this.$refs.upload.clearFiles(),this.fileList=this.$refs.upload.uploadFiles,this.fileCount=0,this.uploadCount=0,this.uploadMessage="",this.successInfo=[],this.errorInfo=[]},close:function(){for(var t=this,e=[],s=0;s<this.fileList.length;s++)"uploading"!==this.fileList[s].status&&"ready"!==this.fileList[s].status||(this.$refs.upload.abort(this.fileList[s]),e.push(this.fileList[s].name));e.length>0&&(e.forEach(function(e){t.uploadMessage+='<p style="color: #000">'+e+": 取消上传</p>"}),this.$notify({title:"上传文件信息",dangerouslyUseHTMLString:!0,message:this.uploadMessage,offset:100})),this.object.close()}},computed:{tips:function(){var t="",e=this.object.accept;return e.length>0&&e.forEach(function(s,i){i!==e.length-1?t+=s+",":t+=s}),t?"(接受文件类型："+t+")":""}}}]},c={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-dialog",{attrs:{title:t.object.title,visible:t.object.show,top:t.object.top,width:t.object.width},on:{"update:visible":function(e){t.$set(t.object,"show",e)}}},[t.object.form?s("dc-form",{attrs:{object:t.object.form}}):t._e(),t._v(" "),s("el-upload",{ref:"upload",attrs:{action:t.object.origin,"on-error":t.handleError,"on-success":t.handleSuccess,name:t.object.name,data:t.object.body,"on-change":t.fileChange,"show-file-list":!1,multiple:t.object.multiple,limit:t.object.limit,"on-exceed":t.handleExceed,"auto-upload":!1}},[s("div",{staticClass:"btn-warpper"},[s("el-button",{attrs:{type:"primary"}},[t._v("选择文件")]),t._v("\n            "+t._s(t.tips)+"\n        ")],1),t._v(" "),"file"===t.object.type?s("ul",t._l(t.fileList,function(e){return s("li",{key:e.uid},[s("span",[t._v(t._s(e.name))]),t._v(" "),"ready"===e.status?s("i",{staticClass:"el-icon-close icon",on:{click:function(s){s.stopPropagation(),t.removeFile(e)}}}):t._e(),t._v(" "),"uploading"===e.status?s("i",{staticClass:"el-icon-loading icon"}):t._e(),t._v(" "),"success"===e.status?s("i",{staticClass:"el-icon-success icon"}):t._e(),t._v(" "),"error"===e.status?s("i",{staticClass:"el-icon-error icon"}):t._e()])})):t._e(),t._v(" "),"image"===t.object.type?s("ul",{staticClass:"image-wrapper"},t._l(t.fileList,function(e){return s("li",{key:e.uid},[s("img",{attrs:{src:e.src,alt:""}}),t._v(" "),s("span",{staticClass:"file-name"},[t._v(t._s(e.name))]),t._v(" "),"ready"===e.status?s("i",{staticClass:"el-icon-close icon",on:{click:function(s){s.stopPropagation(),t.removeFile(e)}}}):t._e(),t._v(" "),"uploading"===e.status?s("i",{staticClass:"el-icon-loading icon"}):t._e(),t._v(" "),"success"===e.status?s("i",{staticClass:"el-icon-success icon"}):t._e(),t._v(" "),"error"===e.status?s("i",{staticClass:"el-icon-error icon"}):t._e()])})):t._e()]),t._v(" "),s("p",{style:"text-align: "+t.object.btnAlign},[t.object.form?s("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){return e.stopPropagation(),t.submitUpload(e)}}},[t._v("确实")]):s("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"success",disabled:t.fileList.length<1},on:{click:function(e){return e.stopPropagation(),t.submitUpload(e)}}},[t._v("上传")]),t._v(" "),s("el-button",{attrs:{disabled:t.fileList.length<1},on:{click:t.clear}},[t._v("清空列表")]),t._v(" "),s("el-button",{on:{click:t.close}},[t._v("取消")])],1)],1)},staticRenderFns:[]};var r=s("VU/8")(a,c,!1,function(t){s("uHTO")},"data-v-3f5fcb44",null);e.default=r.exports},uHTO:function(t,e){}});